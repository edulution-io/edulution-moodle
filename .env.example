# =====================================================
# EDULUTION MOODLE - KONFIGURATION
# =====================================================
# Kopiere diese Datei nach .env und passe die Werte an:
#   cp .env.example .env
#
# WICHTIG: Alle Passwoerter mit "CHANGE_ME" MUESSEN geaendert werden!
# =====================================================


# =====================================================
# MOODLE GRUNDKONFIGURATION
# =====================================================

# Moodle Version (Git Branch)
# Verfuegbare Versionen: MOODLE_404_STABLE, MOODLE_405_STABLE, etc.
MOODLE_VERSION=MOODLE_405_STABLE

# Docker Image Version
VERSION=latest

# Vollstaendige URL zu Moodle (mit https:// oder http://)
MOODLE_WWWROOT=https://moodle.example.com

# Name der Moodle-Instanz (wird auf der Startseite angezeigt)
MOODLE_SITE_NAME=Meine Schule - Moodle

# Port fuer HTTP-Zugriff (ohne Traefik/SSL)
MOODLE_PORT=8080

# Admin-Benutzer Konfiguration
MOODLE_ADMIN_USER=admin
MOODLE_ADMIN_PASSWORD=CHANGE_ME_SECURE_PASSWORD
MOODLE_ADMIN_EMAIL=admin@example.com

# Standard-Sprache (de, de_comm, en, etc.)
# de_comm = Deutsch (Du-Form)
MOODLE_DEFAULT_LANGUAGE=de

# Zusaetzliche Sprachpakete installieren (kommagetrennt)
MOODLE_INSTALL_LANGUAGES=de,de_comm,en


# =====================================================
# DATENBANK KONFIGURATION
# =====================================================

# Datenbankname
DB_NAME=moodle

# Datenbank-Benutzer
DB_USER=moodle

# Datenbank-Passwort (MUSS geaendert werden!)
DB_PASSWORD=CHANGE_ME_DB_PASSWORD

# MariaDB Root-Passwort (MUSS geaendert werden!)
DB_ROOT_PASSWORD=CHANGE_ME_ROOT_PASSWORD


# =====================================================
# KEYCLOAK SSO (optional)
# =====================================================
# Leer lassen wenn kein SSO gewuenscht ist.
# Bei Verwendung mit edulution werden diese Werte automatisch gesetzt.

# Keycloak Server URL (mit /auth/ am Ende)
KEYCLOAK_SERVER_URL=

# Keycloak Realm Name
KEYCLOAK_REALM=

# Client ID fuer Moodle-Sync
KEYCLOAK_CLIENT_ID=

# Client Secret (aus Keycloak) - ERFORDERLICH fuer Sync!
# Dies ist das Secret des Service Account Clients in Keycloak
KEYCLOAK_SECRET_KEY=

# SSL-Zertifikate pruefen (1=ja, 0=nein - nur fuer Entwicklung!)
KEYCLOAK_VERIFY_SSL=1


# =====================================================
# SYNC KONFIGURATION
# =====================================================
# Nur relevant wenn Keycloak konfiguriert ist.

# Sync aktivieren (0=aus, 1=an)
SYNC_ENABLED=0

# Sync-Intervall in Sekunden (Standard: 5 Minuten)
SYNC_INTERVAL=300

# Dry-Run Modus: Zeigt was passieren wuerde ohne Aenderungen
# WICHTIG: Erst mit DRY_RUN=1 testen!
DRY_RUN=0


# =====================================================
# USER SYNC KONFIGURATION
# =====================================================

# Welche Keycloak-Gruppen sollen synchronisiert werden? (kommagetrennt)
SYNC_USERS_IN_GROUPS=role-schooladministrator,role-teacher,role-student

# ALLE User aus Keycloak synchronisieren (ignoriert Gruppen-Filter)
# WARNUNG: Kann tausende User synchronisieren!
SYNC_ALL_USERS=0

# Diese Benutzernamen niemals synchronisieren (kommagetrennt)
IGNORE_USERS=admin,guest,root

# Diese Benutzernamen niemals loeschen/deaktivieren (kommagetrennt)
PROTECTED_USERS=admin,guest


# =====================================================
# ROLLEN-MAPPING
# =====================================================
# Welche Keycloak-Gruppen welchen Moodle-Rollen zugeordnet werden.

# Schueler/Studenten
ROLE_STUDENT_GROUPS=role-student
ROLE_STUDENT_MOODLE=student

# Lehrer (mit Bearbeitungsrechten)
ROLE_TEACHER_GROUPS=role-teacher
ROLE_TEACHER_MOODLE=editingteacher

# Manager/Administratoren (Kursverwaltung)
ROLE_MANAGER_GROUPS=role-schooladministrator
ROLE_MANAGER_MOODLE=manager


# =====================================================
# KURS-SYNC KONFIGURATION
# =====================================================

# Keycloak-Gruppen-Attribut das einen Kurs markiert
COURSE_SYNC_ATTRIBUTE=moodleCourse

# Standard-Kategorie fuer neue Kurse (Kategorie-ID)
DEFAULT_COURSE_CATEGORY=1

# Standard-Kursformat (topics, weeks, social, singleactivity)
DEFAULT_COURSE_FORMAT=topics


# =====================================================
# SOFT-DELETE / LOESCHUNG
# =====================================================

# Soft-Delete aktivieren (User werden erst deaktiviert, nicht geloescht)
SOFT_DELETE_ENABLED=1

# Wartezeit bevor deaktivierte User geloescht werden (in Sekunden)
# Standard: 30 Tage = 2592000 Sekunden
SOFT_DELETE_GRACE_PERIOD=2592000

# Echtes Loeschen aktivieren (VORSICHT!)
# 0 = User werden nur deaktiviert
# 1 = User werden nach Grace Period geloescht
DELETE_ENABLED=0


# =====================================================
# SMTP MAIL KONFIGURATION (optional)
# =====================================================
# Fuer E-Mail-Benachrichtigungen aus Moodle.

# SMTP Server
SMTP_HOST=

# SMTP Port (587 fuer TLS, 465 fuer SSL)
SMTP_PORT=587

# SMTP Benutzer
SMTP_USER=

# SMTP Passwort
SMTP_PASSWORD=

# Verschluesselung (tls, ssl, oder leer)
SMTP_SECURITY=tls

# Absender fuer System-Mails
SMTP_NOREPLY=noreply@example.com


# =====================================================
# SSL / TRAEFIK (optional)
# =====================================================
# Fuer automatische SSL-Zertifikate mit Let's Encrypt.
# Starten mit: docker compose --profile ssl up -d

# Domain fuer Traefik (muss auf diesen Server zeigen)
MOODLE_DOMAIN=moodle.example.com

# E-Mail fuer Let's Encrypt Zertifikate
ACME_EMAIL=admin@example.com


# =====================================================
# UPDATES
# =====================================================

# Automatische Moodle-Updates (0=aus, 1=an)
# WARNUNG: Nur aktivieren wenn Backups eingerichtet sind!
MOODLE_AUTO_UPDATE=0

# Automatische Plugin-Updates
PLUGIN_AUTO_UPDATE=0

# Backup vor Update erstellen
BACKUP_BEFORE_UPDATE=1


# =====================================================
# REDIS CACHE
# =====================================================
# Redis wird fuer Session-Caching und Moodle-Cache verwendet.
# Die Standardwerte funktionieren mit dem mitgelieferten Redis-Container.

# Redis Host (Standard: redis Container)
REDIS_HOST=redis

# Redis Port
REDIS_PORT=6379
